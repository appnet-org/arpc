// Code generated by protoc-gen-symphony-hybrid. DO NOT EDIT.
package kv_proto

import (
	"encoding/binary"
	"fmt"

	"google.golang.org/protobuf/proto"
)

func (m *GetRequest) MarshalSymphonyHybrid() ([]byte, error) {
	// Calculate public segment size
	publicSegmentSize := 13
	publicSegmentSize += 0 // public table

	// Marshal private fields using protobuf
	privateMsg := &GetRequest{
		Key: m.Key,
	}
	privateData, err := proto.Marshal(privateMsg)
	if err != nil {
		return nil, fmt.Errorf("failed to marshal private segment: %w", err)
	}

	// Calculate total size
	totalSize := publicSegmentSize + len(privateData)
	buf := make([]byte, totalSize)

	// Write header
	buf[0] = 0x01                                                      // version byte
	binary.LittleEndian.PutUint32(buf[1:5], uint32(publicSegmentSize)) // offset_to_private
	binary.LittleEndian.PutUint32(buf[5:9], 0)                         // service_id
	binary.LittleEndian.PutUint32(buf[9:13], 0)                        // method_id

	// Write public segment (Symphony format)
	publicTableStart := 13
	publicPayloadStart := publicTableStart + 0
	publicPayloadOffset := 0
	dataLen := 0
	_ = publicPayloadStart
	_ = publicPayloadOffset
	_ = dataLen

	// Write private segment (Protobuf format)
	copy(buf[publicSegmentSize:], privateData)

	return buf, nil
}

func (m *GetRequest) UnmarshalSymphonyHybrid(data []byte) error {
	if len(data) < 13 {
		return fmt.Errorf("invalid data: too short")
	}

	// Validate public segment version
	if data[0] != 0x01 {
		return fmt.Errorf("invalid data: wrong public version")
	}

	// Read header
	offsetToPrivate := int(binary.LittleEndian.Uint32(data[1:5]))
	// service_name := binary.LittleEndian.Uint32(data[5:9])  // not used yet
	// method_name := binary.LittleEndian.Uint32(data[9:13])  // not used yet

	payloadOffset := 0
	_ = payloadOffset
	dataLen := 0
	_ = dataLen
	count := 0
	_ = count
	currentOffset := 0
	_ = currentOffset

	// === PUBLIC FIELDS (Symphony format) ===
	publicTableStart := 13
	_ = publicTableStart
	// === PRIVATE FIELDS (Protobuf format) ===
	if offsetToPrivate < len(data) {
		privateData := data[offsetToPrivate:]
		privateMsg := &GetRequest{}
		if err := proto.Unmarshal(privateData, privateMsg); err != nil {
			return fmt.Errorf("failed to unmarshal private segment: %w", err)
		}
		m.Key = privateMsg.Key
	}
	return nil
}

func (m *SetRequest) MarshalSymphonyHybrid() ([]byte, error) {
	// Calculate public segment size
	publicSegmentSize := 13
	publicSegmentSize += 0 // public table

	// Marshal private fields using protobuf
	privateMsg := &SetRequest{
		Key:   m.Key,
		Value: m.Value,
	}
	privateData, err := proto.Marshal(privateMsg)
	if err != nil {
		return nil, fmt.Errorf("failed to marshal private segment: %w", err)
	}

	// Calculate total size
	totalSize := publicSegmentSize + len(privateData)
	buf := make([]byte, totalSize)

	// Write header
	buf[0] = 0x01                                                      // version byte
	binary.LittleEndian.PutUint32(buf[1:5], uint32(publicSegmentSize)) // offset_to_private
	binary.LittleEndian.PutUint32(buf[5:9], 0)                         // service_id
	binary.LittleEndian.PutUint32(buf[9:13], 0)                        // method_id

	// Write public segment (Symphony format)
	publicTableStart := 13
	publicPayloadStart := publicTableStart + 0
	publicPayloadOffset := 0
	dataLen := 0
	_ = publicPayloadStart
	_ = publicPayloadOffset
	_ = dataLen

	// Write private segment (Protobuf format)
	copy(buf[publicSegmentSize:], privateData)

	return buf, nil
}

func (m *SetRequest) UnmarshalSymphonyHybrid(data []byte) error {
	if len(data) < 13 {
		return fmt.Errorf("invalid data: too short")
	}

	// Validate public segment version
	if data[0] != 0x01 {
		return fmt.Errorf("invalid data: wrong public version")
	}

	// Read header
	offsetToPrivate := int(binary.LittleEndian.Uint32(data[1:5]))
	// service_name := binary.LittleEndian.Uint32(data[5:9])  // not used yet
	// method_name := binary.LittleEndian.Uint32(data[9:13])  // not used yet

	payloadOffset := 0
	_ = payloadOffset
	dataLen := 0
	_ = dataLen
	count := 0
	_ = count
	currentOffset := 0
	_ = currentOffset

	// === PUBLIC FIELDS (Symphony format) ===
	publicTableStart := 13
	_ = publicTableStart
	// === PRIVATE FIELDS (Protobuf format) ===
	if offsetToPrivate < len(data) {
		privateData := data[offsetToPrivate:]
		privateMsg := &SetRequest{}
		if err := proto.Unmarshal(privateData, privateMsg); err != nil {
			return fmt.Errorf("failed to unmarshal private segment: %w", err)
		}
		m.Key = privateMsg.Key
		m.Value = privateMsg.Value
	}
	return nil
}
